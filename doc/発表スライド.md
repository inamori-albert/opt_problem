<!-- $theme: default -->

# ソルバーを使って組合せ最適化問題を解く(実践編)

----
## 最適化問題

ある制限を満たしながら、何らかの指標を最大(または最小)にする組み合わせを探す

* 何らかの指標	：目的関数
* ある制限		  ：制約条件
* 組み合わせ		  :変数

組合せ最適化問題は、変数が離散値の最適化問題

----
## 組合せ最適化問題例：ナップサック問題

問題：
『容量 C のナップサックが一つと、n 種類の品物（各々、価値 pi, 容積 ci）が与えられたとき、ナップサックの容量 C を超えない範囲でいくつかの品物をナップサックに詰め、ナップサックに入れた品物の価値の和を最大化するにはどの品物を選べばよいか』

定式化：
$$
\begin{aligned}
  \mathrm{Max} \space f(x) = \sum_i {p_i x_i} \\
  \sum_i {c_i x_i} \leqq C \\
  \forall x_i \in {0, 1} 
\end{aligned}
$$

----
## 定式化

* 定式化とは、問題を数理モデルで定義すること
	* 最適化問題を解くためには、問題の定式化が重要！
	* 問題の表現方法によって解きやすさが変わる
	
* 定式化すればソルバーの利用で解を見つけることが可能

![問題の解き方](C:\Users\inaty\Downloads\opt_problem-master\opt_problem-master\doc\問題の解き方.png)

----
## 定式化の体系

定式化には、

* 「標準問題」による分類
* 「数理問題」による分類

の2種類の分類方法を意識すると分かりやすいです。

それぞれの問題の種類には名前がついています。
　　例：ナップサック問題、重み付き制約充足問題

問題の解き方を調べる際便利なのでおぼえておきましょう。

----
## 「標準問題」による分類

標準問題とは、実務でよくある問題に名前を付けたもの

下の本などで割と体系立ててまとめられています。

![本2](https://images-na.ssl-images-amazon.com/images/I/51ZLhIEKdCL._AC_UL320_SR224,320_.jpg "本2")

[標準問題一覧 Qiita記事](https://qiita.com/SaitoTsutomu/items/0f6c1a4415d196e64314)

----
## 「数理問題」による分類
問題の性質に関して細かい分類があります。
* 単目的か多目的か
* 変数が連続か離散か
* 目的関数が線形か非線形か
* 制約条件があるかないか
・・・

問題の性質によって解きやすさがかなり違いますが、、、

最初は、
* 目的関数が単目的だと簡単 ⇔ 目的関数が多目的だと難しい
* 目的関数が線形だと簡単 ⇔ 目的関数が非線形だと難しい
* 変数の次元が小さいと簡単 ⇔ 変数の次元が大きいと難しい
* 変数の数が少ないと簡単 ⇔ 変数の数が多いと難しい
* 目的関数が凸だと簡単 ⇔ 目的関数が非凸だと難しい

くらいのイメージでいい気がする。

----
## 最適化問題を解く際の動き
1. 問題を定式化
	1. 標準問題一覧を見て、同じ構造が使える問題を探す
	2. i.で標準問題の形にできなければ、問題の性質を考えながらできるだけ簡単な性質の数理問題に変形する
2. 1.で定式化した問題を解けるソルバーを調べる(※)
3. 2.で見つかったそる場の中で、一番早く安定して問題が解けるソルバーを選択
4. 3.で無理そうなら制約条件を緩和するなどして問題を変形して2.へ

※ 全探索で解ける問題規模ならば全探索で解いた方がいいです

----
## 複数のソルバーを試す方法

* 解きたい定式化した問題を、LPファイル形式で記述し、NEOS SERVERで解いてみるのが、早くてよさそうです

* [NEOS Server](https://neos-server.org/neos/solvers/index.html) 
  ・・・ 商用・非商用のソルバーが利用できる公開サーバ(※)

* LPファイル形式
 ・・・ ほとんどのソルバーで利用できる共通問題表現形式

※難点=問題サイズに制限有。問題が公開されるという制限もあった気が・・・

----
## 複数のソルバーを試す方法
実際にやってみます。

----
## 余談：[Google Optimization Tools](https://developers.google.com/optimization/)

* ドキュメントが分かりやすい
* 割とまっとうに動く(気がする)

##A## 対応している問題
* 標準問題
  * Bin Packing：積載効率最適化
  * Scheduling：シフト最適化
  * Flow Algorithms：流量最適化
  * Routing：経路最適化
  * Puzzles：（特定条件に基づいた）パズルを解く

* 数理問題
  * Linear Optimization：線形最適
  * Integer Optimization：整数問題

----
